<!DOCTYPE html>

<html>

<head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>mint.js</title>
<link rel="stylesheet" href="default.css">
</head>

<body>
<table cellspacing="0" cellpadding="0">
  <thead>
    <tr>
      <th class="docs"><h1>mint.js</h1></th>
      <th class="code"></th>
    </tr>
  </thead>
  <tbody>
    <tr id="section-0">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-0">#</a>
        </div>
        <p>Mint is a small, fast documentation generator for literate-style programming
that produces HTML files from your source code. In literate programming, the
emphasis is placed on writing clear documentation in ordinary human language
instead of writing terse half-sentences. The code is considered merely an
artifact of the documentation. Thus, in Mint the documentation is displayed
most prominently, right alongside the fragments of code to which each section
pertains.</p>

<p>Mint was inspired by (and borrows heavily from) Docco, the original quick-n-dirty
documentation generator by Jeremy Ashkenas, with the main difference being that
Mint is written in JavaScript instead of CoffeeScript. Code comments are written
in Markdown and templates use Mustache.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">sys</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sys&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">Mu</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;Mu&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;mu&#39;</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">Markdown</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="s1">&#39;vendor&#39;</span><span class="p">,</span> <span class="s1">&#39;markdown-js&#39;</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;markdown&#39;</span><span class="p">));</span>
<span class="kd">var</span> <span class="nx">Mint</span> <span class="o">=</span> <span class="nx">exports</span><span class="p">;</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-1">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-1">#</a>
        </div>
        <p>The start/end of each Pygments highlight block.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">highlightStart</span> <span class="o">=</span> <span class="s1">&#39;&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">highlightEnd</span> <span class="o">=</span> <span class="s1">&#39;&lt;/pre&gt;&lt;/div&gt;&#39;</span><span class="p">;</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-2">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-2">#</a>
        </div>
        <p>The paths to all source files being processed.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">allFiles</span> <span class="o">=</span> <span class="p">[];</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-3">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-3">#</a>
        </div>
        <p>These flags represent the types of comments that may be found in source
code. They are calculated as powers of 2 (2^0, 2^1, etc.) so that they
may be combined using the bitwise OR operator to represent more than one
type of comment for a particular language.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">PARSE_OCTOTHORP</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="nx">PARSE_SEMICOLON</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="nx">PARSE_SLASHSTAR</span>  <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">;</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-4">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-4">#</a>
        </div>
        <p>This map may be used to lookup the types of comments that a particular
file may contain, judging by its file extension.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">var</span> <span class="nx">parseFlags</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;.as&#39;</span>       <span class="o">:</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">|</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.c&#39;</span>        <span class="o">:</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.cc&#39;</span>       <span class="o">:</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">|</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.coffee&#39;</span>   <span class="o">:</span> <span class="nx">PARSE_OCTOTHORP</span><span class="p">,</span>
    <span class="s1">&#39;.conf&#39;</span>     <span class="o">:</span> <span class="nx">PARSE_OCTOTHORP</span><span class="p">,</span>
    <span class="s1">&#39;.css&#39;</span>      <span class="o">:</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.ini&#39;</span>      <span class="o">:</span> <span class="nx">PARSE_SEMICOLON</span><span class="p">,</span>
    <span class="s1">&#39;.java&#39;</span>     <span class="o">:</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">|</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.js&#39;</span>       <span class="o">:</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">|</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.m&#39;</span>        <span class="o">:</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">|</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.php&#39;</span>      <span class="o">:</span> <span class="nx">PARSE_SLASHSLASH</span> <span class="o">|</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">,</span>
    <span class="s1">&#39;.py&#39;</span>       <span class="o">:</span> <span class="nx">PARSE_OCTOTHORP</span><span class="p">,</span>
    <span class="s1">&#39;.rb&#39;</span>       <span class="o">:</span> <span class="nx">PARSE_OCTOTHORP</span>
<span class="p">};</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-5">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-5">#</a>
        </div>
        <h2>Properties</h2>
      </td>
      <td class="code">
        <div class="highlight"><pre></pre></div>
      </td>
    </tr>
    <tr id="section-6">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-6">#</a>
        </div>
        <p>The current version of Mint.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="s1">&#39;0.3&#39;</span><span class="p">;</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-7">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-7">#</a>
        </div>
        <p>The directory to use for the output.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">outputDir</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span><span class="p">;</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-8">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-8">#</a>
        </div>
        <p>The <code>templateRoot</code> and <code>templateExtension</code> properties are merely aliases
for properties of the same name on the <a href="http://github.com/raycmorgan/Mu">Mu</a>
object.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;templateRoot&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Mu</span><span class="p">.</span><span class="nx">templateRoot</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Mint</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;templateRoot&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Mu</span><span class="p">.</span><span class="nx">templateRoot</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Mint</span><span class="p">.</span><span class="nx">__defineGetter__</span><span class="p">(</span><span class="s1">&#39;templateExtension&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Mu</span><span class="p">.</span><span class="nx">templateExtension</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Mint</span><span class="p">.</span><span class="nx">__defineSetter__</span><span class="p">(</span><span class="s1">&#39;templateExtension&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">Mu</span><span class="p">.</span><span class="nx">templateExtension</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
<span class="p">});</span>

<span class="nx">Mint</span><span class="p">.</span><span class="nx">templateRoot</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">);</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-9">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-9">#</a>
        </div>
        <h2>Main Functions</h2>
      </td>
      <td class="code">
        <div class="highlight"><pre></pre></div>
      </td>
    </tr>
    <tr id="section-10">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-10">#</a>
        </div>
        <p>We need to make sure all necessary dependencies are installed. Call this
function before anything else to check that they are. If not, we should
fail here and let the user know.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">checkEnvironment</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_checkEnvironment</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sys</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;pygmentize&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">sys</span><span class="p">.</span><span class="nx">puts</span><span class="p">(</span><span class="s1">&#39;No pygmentize found. Try `sudo easy_install pygments`&#39;</span><span class="p">);</span>
            <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">callback</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-11">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-11">#</a>
        </div>
        <p>The main point of entry for an external program, this function takes an
array of files that are to be used in the documentation. By the time
this function is called, all properties on the Mint object should be set.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">go</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_go</span><span class="p">(</span><span class="nx">sourceFiles</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">allFiles</span> <span class="o">=</span> <span class="nx">sourceFiles</span><span class="p">;</span>

    <span class="nx">path</span><span class="p">.</span><span class="nx">exists</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">outputDir</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">exists</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">exists</span><span class="p">)</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">mkdirSync</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">outputDir</span><span class="p">,</span> <span class="mi">0755</span><span class="p">);</span>

        <span class="nx">sourceFiles</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">Mint</span><span class="p">.</span><span class="nx">getLexer</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lexer</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">sections</span> <span class="o">=</span> <span class="nx">Mint</span><span class="p">.</span><span class="nx">parseFile</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
                <span class="nx">Mint</span><span class="p">.</span><span class="nx">format</span><span class="p">(</span><span class="nx">lexer</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">Mint</span><span class="p">.</span><span class="nx">output</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">sections</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">});</span>

        <span class="nx">Mint</span><span class="p">.</span><span class="nx">copyStaticFiles</span><span class="p">();</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-12">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-12">#</a>
        </div>
        <p>This function simply wraps a system call to <code>pygmentize -N</code> and retrieves
the name of the lexer that Pygments will use to parse a given file.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">getLexer</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_getLexer</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">sys</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="s1">&#39;pygmentize -N &#39;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">stdout</span><span class="p">,</span> <span class="nx">stderr</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">lexer</span> <span class="o">=</span> <span class="nx">stdout</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="nx">callback</span><span class="p">(</span><span class="nx">lexer</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-13">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-13">#</a>
        </div>
        <p>This function accepts a documentation block and strips any unnecessary
leading or trailing comment characters and whitespace. It's used for
cleaning up documentation blocks before sending them through the
Markdown parser.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">stripDocs</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_stripDocs</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*\/\//</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stripSymbol</span><span class="p">(</span><span class="s1">&#39;\\/\\/&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*#/</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stripSymbol</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*;/</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">stripSymbol</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^\s*\/\*/</span><span class="p">))</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id="section-14">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-14">#</a>
        </div>
        <p>Strip all preceeding stars and whitespace except for the last one.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s*\/[\*\s\n]*\*/</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">);</span></pre></div>
      </td>
    </tr>
    <tr id="section-15">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-15">#</a>
        </div>
        <p>Strip all trailing stars and whitespace.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>        <span class="nx">doc</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s*\*+\/\s*$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">stripSymbol</span><span class="p">(</span><span class="s1">&#39;\\*&#39;</span><span class="p">,</span> <span class="nx">doc</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-16">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-16">#</a>
        </div>
        <p>We don't recognize this comment format.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">doc</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-17">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-17">#</a>
        </div>
        <p>This function is used by <code>Mint.stripDocs</code> to strip the given <code>symbol</code> from
the beginning of each line in <code>doc</code>.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">function</span> <span class="nx">stripSymbol</span><span class="p">(</span><span class="nx">symbol</span><span class="p">,</span> <span class="nx">doc</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">indentRe</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^\\s*&#39;</span> <span class="o">+</span> <span class="nx">symbol</span> <span class="o">+</span> <span class="s1">&#39;( *)&#39;</span><span class="p">),</span>
        <span class="nx">lines</span> <span class="o">=</span> <span class="nx">splitLines</span><span class="p">(</span><span class="nx">doc</span><span class="p">),</span>
        <span class="nx">stripped</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">lineRe</span><span class="p">,</span>
        <span class="nx">match</span><span class="p">;</span>

    <span class="nx">lines</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id="section-18">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-18">#</a>
        </div>
        <p>The indent to use for the entire block takes its queue from
the indent of the first line. Subsequent lines in the same block
may have a smaller indent, but if the indent is greater it should
be preserved.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">lineRe</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">indentRe</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">indent</span> <span class="o">=</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span>
                <span class="nx">lineRe</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^\\s*&#39;</span> <span class="o">+</span> <span class="nx">symbol</span> <span class="o">+</span> <span class="s1">&#39; {0,&#39;</span> <span class="o">+</span> <span class="nx">indent</span> <span class="o">+</span> <span class="s1">&#39;}&#39;</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">lineRe</span> <span class="o">&amp;&amp;</span> <span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">lineRe</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">stripped</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">lineRe</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">stripped</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-19">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-19">#</a>
        </div>
        <p>A convenience function for parsing the contents of a file. If we don't
recognize the file extension, we assume it has comments in the classic
octothorp style.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">parseFile</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_parseFile</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span>
        <span class="nx">flags</span> <span class="o">=</span> <span class="nx">parseFlags</span><span class="p">[</span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">file</span><span class="p">)]</span> <span class="o">||</span> <span class="nx">PARSE_OCTOTHORP</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">Mint</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">flags</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-20">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-20">#</a>
        </div>
        <p>Here we parse the <code>source</code> code from the given file into <em>sections</em>, each of
which consists of a comment and the code that followed it in the following
form:</p>

<pre><code>{
    line: 1,     // The line number on which this section starts
    docs: '',    // The documentation block in its entirety
    code: ''     // The code block
}</code></pre>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">parse</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_parse</span><span class="p">(</span><span class="nx">code</span><span class="p">,</span> <span class="nx">flags</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">comments</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">lines</span> <span class="o">=</span> <span class="nx">splitLines</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-21">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-21">#</a>
        </div>
        <p>This utility function tells us if the given <code>index</code> is already
contained in the <code>comments</code> array. It's a safety to make sure we don't
include the same lines multiple times.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">commentsAlreadyContain</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nx">index</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nx">index</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-22">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-22">#</a>
        </div>
        <p>Find all comments in the file depending on what kinds of comments we
expect to find.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">PARSE_SLASHSLASH</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">comments</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">findLines</span><span class="p">(</span><span class="sr">/^\s*\/\/(.|\n)*$/</span><span class="p">,</span> <span class="nx">lines</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">PARSE_OCTOTHORP</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">comments</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">findLines</span><span class="p">(</span><span class="sr">/^\s*#(.|\n)*$/</span><span class="p">,</span> <span class="nx">lines</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">PARSE_SEMICOLON</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">comments</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">findLines</span><span class="p">(</span><span class="sr">/^\s*;(.|\n)*$/</span><span class="p">,</span> <span class="nx">lines</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">flags</span> <span class="o">&amp;</span> <span class="nx">PARSE_SLASHSTAR</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">comment</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">index</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="o">++</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="sr">/^\s*\/\*/</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">commentsAlreadyContain</span><span class="p">(</span><span class="nx">index</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">comment</span> <span class="o">=</span> <span class="p">[</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
                <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="sr">/\*\//</span><span class="p">).</span><span class="nx">test</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="nx">index</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">comment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="nx">index</span><span class="o">++</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">comments</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-23">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-23">#</a>
        </div>
        <p>Sort the comments found by starting line number so we can perform the
parse linearly.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>    <span class="nx">comments</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// This should never happen!</span>
    <span class="p">});</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-24">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-24">#</a>
        </div>
        <p>Work through the <code>comments</code> array extracting sections of documentation
blocks and code as we go.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">sections</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">docLines</span><span class="p">,</span>
        <span class="nx">codeLines</span><span class="p">;</span>
    <span class="nx">comments</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">docLines</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">comments</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">codeLines</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">comments</span><span class="p">[</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">codeLines</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>

        <span class="nx">sections</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
            <span class="nx">line</span><span class="o">:</span> <span class="nx">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="nx">docs</span><span class="o">:</span> <span class="nx">docLines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span>
            <span class="nx">code</span><span class="o">:</span> <span class="nx">codeLines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">});</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">sections</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-25">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-25">#</a>
        </div>
        <p>Finds lines in the given array of <code>lines</code> that match the given regex. If
consecutive lines are found, they should be grouped together as a single
documentation block.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">function</span> <span class="nx">findLines</span><span class="p">(</span><span class="nx">regex</span><span class="p">,</span> <span class="nx">lines</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">comment</span><span class="p">,</span>
        <span class="nx">comments</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="nx">lines</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">comment</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">comment</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">comment</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">comment</span> <span class="o">=</span> <span class="p">[</span><span class="nx">index</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>
                <span class="nx">comments</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">comments</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-26">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-26">#</a>
        </div>
        <p>This function expects the name of a file and its parsed <em>sections</em> (see
<code>Mint.parse</code>). Document text is run through Markdown and code is run
through Pygments here. After this method executes, each section will
have <code>docsHtml</code> and <code>codeHtml</code> attributes containing the result of these
operations.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">format</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_format</span><span class="p">(</span><span class="nx">lexer</span><span class="p">,</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-l&#39;</span><span class="p">,</span> <span class="nx">lexer</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;html&#39;</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">child</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">createChildProcess</span><span class="p">(</span><span class="s1">&#39;pygmentize&#39;</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdio</span><span class="p">.</span><span class="nx">writeError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;output&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="nx">output</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;exit&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id="section-27">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-27">#</a>
        </div>
        <p>Strip the wrapper &lt;div&gt; that Pygments inserts.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>        <span class="nx">output</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">highlightStart</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">highlightEnd</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">),</span> <span class="nx">codeLines</span><span class="p">,</span> <span class="nx">codeHtml</span><span class="p">,</span> <span class="nx">currentLine</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">sections</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">section</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span></pre></div>
      </td>
    </tr>
    <tr id="section-28">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-28">#</a>
        </div>
        <p>Strip all comment characters from the docs and format them using
Markdown.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>            <span class="nx">section</span><span class="p">.</span><span class="nx">docsHtml</span> <span class="o">=</span> <span class="nx">Markdown</span><span class="p">.</span><span class="nx">toHTML</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">stripDocs</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">docs</span><span class="p">));</span></pre></div>
      </td>
    </tr>
    <tr id="section-29">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-29">#</a>
        </div>
        <p>Pygments preserves newlines when formatting code, so we can use
the number of newline characters present in a given block to
extract the formatted result from the HTML output. As we go, keep
track of our current position in the output in <code>currentLine</code> so
we can extract from there on subsequent sections.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre>            <span class="nx">codeLines</span> <span class="o">=</span> <span class="nx">substrCount</span><span class="p">(</span><span class="nx">section</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="s1">&#39;\n&#39;</span><span class="p">);</span>
            <span class="nx">codeHtml</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">currentLine</span><span class="p">,</span> <span class="nx">currentLine</span> <span class="o">+</span> <span class="nx">codeLines</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
            <span class="nx">section</span><span class="p">.</span><span class="nx">codeHtml</span> <span class="o">=</span> <span class="nx">highlightStart</span> <span class="o">+</span> <span class="nx">codeHtml</span> <span class="o">+</span> <span class="nx">highlightEnd</span><span class="p">;</span>
            <span class="nx">currentLine</span> <span class="o">+=</span> <span class="nx">codeLines</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">callback</span><span class="p">();</span>
    <span class="p">});</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">sections</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">s</span><span class="p">.</span><span class="nx">code</span> <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">));</span>
    <span class="nx">child</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-30">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-30">#</a>
        </div>
        <p>Uses the given <code>obj</code> as data for the default template. This may be expanded
in the future to support multiple template names for a given template.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">render</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_render</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">Mu</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="p">{},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">output</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdio</span><span class="p">.</span><span class="nx">writeError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="nx">html</span> <span class="o">+=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">output</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">&#39;end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">callback</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-31">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-31">#</a>
        </div>
        <p>Given a file and its formatted <em>sections</em>, produce an HTML file in the output
directory that contains the result of running the data through the template (see
above).</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">output</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_output</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">sections</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">basename</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">file</span><span class="p">));</span>
    <span class="kd">var</span> <span class="nx">dest</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">outputDir</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span><span class="p">;</span>
    <span class="nx">sections</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span> <span class="nx">s</span><span class="p">.</span><span class="nx">num</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span> <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="nx">title</span><span class="p">,</span> <span class="nx">sections</span><span class="o">:</span> <span class="nx">sections</span><span class="p">,</span> <span class="nx">files</span><span class="o">:</span> <span class="nx">allFiles</span> <span class="p">};</span>
    <span class="nx">Mint</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">html</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="nx">html</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-32">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-32">#</a>
        </div>
        <p>This function copies all JavaScript and CSS files that are part of the
template to the output directory, thus preserving any links to these files
in the template code.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="nx">Mint</span><span class="p">.</span><span class="nx">copyStaticFiles</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">Mint_copyStaticFiles</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">templateRoot</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">error</span><span class="p">;</span>
        <span class="nx">files</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">ext</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ext</span> <span class="o">==</span> <span class="s1">&#39;.css&#39;</span> <span class="o">||</span> <span class="nx">ext</span> <span class="o">==</span> <span class="s1">&#39;.js&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">contents</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">templateRoot</span><span class="p">,</span> <span class="nx">file</span><span class="p">));</span>
                <span class="kd">var</span> <span class="nx">dest</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">Mint</span><span class="p">.</span><span class="nx">outputDir</span><span class="p">,</span> <span class="nx">file</span><span class="p">);</span>
                <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="nx">dest</span><span class="p">,</span> <span class="nx">contents</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-33">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-33">#</a>
        </div>
        <h2>Utility Functions</h2>
      </td>
      <td class="code">
        <div class="highlight"><pre></pre></div>
      </td>
    </tr>
    <tr id="section-34">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-34">#</a>
        </div>
        <p>Splits a string on newline characters (\n), but keeps them at the end of
each line in the result.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">function</span> <span class="nx">splitLines</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">line</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span><span class="p">;</span>
    <span class="p">}).</span><span class="nx">concat</span><span class="p">(</span><span class="nx">lines</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
      </td>
    </tr>
    <tr id="section-35">
      <td class="docs">
        <div class="octowrap">
          <a class="octothorp" href="#section-35">#</a>
        </div>
        <p>Counts the number of times <code>str</code> contains <code>substr</code>.</p>
      </td>
      <td class="code">
        <div class="highlight"><pre><span class="kd">function</span> <span class="nx">substrCount</span><span class="p">(</span><span class="nx">str</span><span class="p">,</span> <span class="nx">substr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">str</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">substr</span><span class="p">).</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span></pre></div>
      </td>
    </tr>
  </tbody>
</table>
</body>

</html>
